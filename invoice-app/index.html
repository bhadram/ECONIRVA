<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECONIRVA - Invoice Management System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // Fallback if CDN fails
        if (typeof html2pdf === 'undefined') {
            document.write('<script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"><\/script>');
        }
    </script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo">
            <img src="logo.jpeg" alt="ECONIRVA">
            <h1>ECONIRVA</h1>
            <span class="tagline">Invoice System</span>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" data-page="dashboard">
                <span class="icon">üìä</span>
                <span>Dashboard</span>
            </li>
            <li class="nav-item" data-page="invoices">
                <span class="icon">üìÑ</span>
                <span>Invoices</span>
            </li>
            <li class="nav-item" data-page="customers">
                <span class="icon">üë•</span>
                <span>Customers</span>
            </li>
            <li class="nav-item" data-page="products">
                <span class="icon">üì¶</span>
                <span>Products</span>
            </li>
            <li class="nav-item" data-page="settings">
                <span class="icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p>¬© 2025-2026 ECONIRVA Bio Solutions Pvt Ltd</p>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar with User Info -->
        <div class="top-bar">
            <div class="welcome-text">Welcome to ECONIRVA Invoice System</div>
            <div class="user-section">
                <span class="user-email" id="user-email">üë§ User</span>
                <button class="logout-btn-top" onclick="localStorage.removeItem('econirva_user'); window.location.href='login.html';">Logout</button>
            </div>
        </div>
        
        <!-- Dashboard Page -->
        <section id="dashboard" class="page active">
            <header class="page-header">
                <h2>Dashboard</h2>
                <button class="btn btn-primary" onclick="showPage('invoices'); openNewInvoice()">
                    <span>+</span> New Invoice
                </button>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">üìÑ</div>
                    <div class="stat-info">
                        <h3 id="total-invoices">0</h3>
                        <p>Total Invoices</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">‚Çπ</div>
                    <div class="stat-info">
                        <h3 id="total-revenue">‚Çπ0</h3>
                        <p>Total Revenue</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">‚è≥</div>
                    <div class="stat-info">
                        <h3 id="pending-amount">‚Çπ0</h3>
                        <p>Pending Amount</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">üë•</div>
                    <div class="stat-info">
                        <h3 id="total-customers">0</h3>
                        <p>Total Customers</p>
                    </div>
                </div>
            </div>
            <div class="recent-section">
                <h3>Recent Invoices</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-invoices-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Invoices Page -->
        <section id="invoices" class="page">
            <header class="page-header">
                <h2>Invoices</h2>
                <button class="btn btn-primary" onclick="openNewInvoice()">
                    <span>+</span> Create Invoice
                </button>
            </header>
            <div class="filters-bar">
                <input type="text" id="invoice-search" placeholder="Search invoices..." class="search-input">
                <select id="invoice-status-filter" class="filter-select">
                    <option value="">All Status</option>
                    <option value="paid">Paid</option>
                    <option value="pending">Pending</option>
                    <option value="overdue">Overdue</option>
                </select>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Due Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoices-body">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Customers Page -->
        <section id="customers" class="page">
            <header class="page-header">
                <h2>Customers</h2>
                <button class="btn btn-primary" onclick="openCustomerModal()">
                    <span>+</span> Add Customer
                </button>
            </header>
            <div class="filters-bar">
                <input type="text" id="customer-search" placeholder="Search customers..." class="search-input">
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>GSTIN</th>
                            <th>Phone</th>
                            <th>City</th>
                            <th>Total Orders</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customers-body">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Products Page -->
        <section id="products" class="page">
            <header class="page-header">
                <h2>Products</h2>
                <button class="btn btn-primary" onclick="openProductModal()">
                    <span>+</span> Add Product
                </button>
            </header>
            <div class="filters-bar">
                <input type="text" id="product-search" placeholder="Search products..." class="search-input">
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>HSN Code</th>
                            <th>Rate (‚Çπ)</th>
                            <th>Unit</th>
                            <th>GST %</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="products-body">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Settings Page -->
        <section id="settings" class="page">
            <header class="page-header">
                <h2>Business Settings</h2>
            </header>
            <div class="settings-form">
                <div class="form-section">
                    <h3>Company Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="company-name" value="ECONIRVA BIO SOLUTIONS PRIVATE LIMITED">
                        </div>
                        <div class="form-group">
                            <label>GSTIN</label>
                            <input type="text" id="company-gstin" value="36AAJCE0856C1ZU">
                        </div>
                        <div class="form-group full-width">
                            <label>Address</label>
                            <textarea id="company-address">Flat No B-523, Block B, Kismatpur Road, The ART by Giridhari Home, Bandlaguda Jagir, Hyderabad, 500086 Telangana, India</textarea>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="company-email" value="econirva@gmail.com">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="company-phone" value="7578007116">
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <input type="text" id="company-state" value="Telangana">
                        </div>
                        <div class="form-group">
                            <label>State Code</label>
                            <input type="text" id="company-state-code" value="36">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Bank Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Bank Name</label>
                            <input type="text" id="bank-name" value="Kotak Bank">
                        </div>
                        <div class="form-group">
                            <label>Account Number</label>
                            <input type="text" id="bank-account" value="8946970807">
                        </div>
                        <div class="form-group">
                            <label>IFSC Code</label>
                            <input type="text" id="bank-ifsc" value="KKBK0000560">
                        </div>
                        <div class="form-group">
                            <label>Account Holder Name</label>
                            <input type="text" id="bank-holder" value="ECONIRVA BIO SOLUTIONS PRIVATE LIMITED">
                        </div>
                        <div class="form-group">
                            <label>UPI / PhonePe Number</label>
                            <input type="text" id="bank-upi" value="7578007116">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Invoice Settings</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Invoice Number Format</label>
                            <select id="invoice-format" onchange="updateFormatPreview()">
                                <option value="financial_year">Financial Year (INV/25-26/001)</option>
                                <option value="date_based">Date Based (INV-20251230-001)</option>
                                <option value="monthly">Monthly (INV-2025-12-001)</option>
                                <option value="sequential">Sequential (INV-001)</option>
                                <option value="custom">Custom Pattern</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Invoice Prefix</label>
                            <input type="text" id="invoice-prefix" value="INV" onchange="updateFormatPreview()">
                        </div>
                        <div class="form-group" id="custom-pattern-group" style="display:none">
                            <label>Custom Pattern</label>
                            <input type="text" id="custom-pattern" value="{PREFIX}/{FY}/{NUM}" onchange="updateFormatPreview()">
                            <small style="color:var(--text-secondary);font-size:0.75rem;margin-top:4px;display:block;">
                                Variables: {PREFIX}, {FY}, {YEAR}, {YY}, {MONTH}, {DAY}, {NUM}, {NUM4}, {NUM5}
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Next Invoice Number</label>
                            <input type="number" id="next-invoice-num" value="1" min="1" onchange="updateFormatPreview()">
                        </div>
                        <div class="form-group full-width">
                            <label>Preview</label>
                            <div id="invoice-preview-box" style="background:var(--bg-dark);padding:12px 16px;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--primary);border:1px solid var(--primary);">
                                INV/25-26/001
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Current Financial Year</label>
                            <input type="text" id="current-fy" readonly style="background:var(--bg-hover);color:var(--text-secondary);">
                        </div>
                        <div class="form-group">
                            <label>Auto-Reset on New FY</label>
                            <div style="padding:10px 0;color:var(--success);">‚úÖ Enabled (resets to 001 on April 1st)</div>
                        </div>
                    </div>
                    <div class="form-grid" style="margin-top:16px;">
                        <div class="form-group">
                            <label>Default GST Rate (%)</label>
                            <input type="number" id="default-gst" value="5" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>Default Payment Terms</label>
                            <select id="default-terms">
                                <option value="Advance">Advance</option>
                                <option value="Due on Receipt">Due on Receipt</option>
                                <option value="Net 15">Net 15</option>
                                <option value="Net 30">Net 30</option>
                            </select>
                        </div>
                    </div>
                    <div id="gaps-warning" style="display:none;margin-top:16px;padding:12px;background:rgba(245,158,11,0.1);border-left:3px solid var(--warning);border-radius:8px;">
                        <strong style="color:var(--warning);">‚ö†Ô∏è Gap Detected:</strong>
                        <span id="gaps-list" style="color:var(--text-secondary);"></span>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Terms & Conditions</h3>
                    <div class="form-group full-width">
                        <textarea id="terms-conditions" rows="10">1. Above Prices are for White Carry Bags.
2. No of Pieces Per Kg May vary +/- 2 to 5 Pieces depends per size.
3. No of Kg's for Each size may vary by +/-5 - 8 Kgs irrespective of your Order Quantities.
4. Kindly Provide us the Sample Bag for Printing reference or else we will proceed as per your description of Colors to be printed on bags.
5. Delivery Time Period will be of 7 Days depends on Order Quantity.
6. Payment Terms: 50% Advance to be Paid along with Purchase order and Balance 50% will be paid at the time of Dispatch.
7. Transportation Price Extra. (Not Included)
8. Goods once sold cannot be taken back. (Except Sealing Issues, which should be report within 72 Hrs)
9. Any Typographical or Clerical Errors are subject to Correction.
10. Any dispute regarding the above will be subject to Jurisdiction of Hyderabad, Telangana.</textarea>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>üë• User Management</h3>
                    <div class="users-list" id="users-list">
                        <!-- Users will be loaded here -->
                    </div>
                    <div class="add-user-form">
                        <h4>Add New User</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="new-user-name" placeholder="User Name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="new-user-email" placeholder="user@email.com">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="text" id="new-user-password" placeholder="Password">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="new-user-role">
                                    <option value="user">User</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="add-user-btn">Add User</button>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </section>
    </main>

    <!-- Customer Modal -->
    <div id="customer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="customer-modal-title">Add Customer</h3>
                <button class="close-btn" onclick="closeModal('customer-modal')">&times;</button>
            </div>
            <form id="customer-form" onsubmit="saveCustomer(event)">
                <input type="hidden" id="customer-id">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Company Name *</label>
                        <input type="text" id="cust-name" required>
                    </div>
                    <div class="form-group">
                        <label>GSTIN</label>
                        <input type="text" id="cust-gstin" placeholder="e.g., 36XXXXXX">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="cust-phone">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="cust-email">
                    </div>
                    <div class="form-group">
                        <label>Contact Person</label>
                        <input type="text" id="cust-contact">
                    </div>
                    <div class="form-group full-width">
                        <label>Billing Address *</label>
                        <textarea id="cust-address" required rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>City *</label>
                        <input type="text" id="cust-city" required>
                    </div>
                    <div class="form-group">
                        <label>State *</label>
                        <input type="text" id="cust-state" required value="Telangana">
                    </div>
                    <div class="form-group">
                        <label>State Code</label>
                        <input type="text" id="cust-state-code" value="36">
                    </div>
                    <div class="form-group">
                        <label>PIN Code</label>
                        <input type="text" id="cust-pin">
                    </div>
                    <div class="form-group full-width">
                        <label>Shipping Address (if different)</label>
                        <textarea id="cust-ship-address" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('customer-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Customer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">Add Product</h3>
                <button class="close-btn" onclick="closeModal('product-modal')">&times;</button>
            </div>
            <form id="product-form" onsubmit="saveProduct(event)">
                <input type="hidden" id="product-id">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Product Name *</label>
                        <input type="text" id="prod-name" required placeholder="e.g., 10 X 12 Carry Bags (Compostable Products)">
                    </div>
                    <div class="form-group">
                        <label>HSN/SAC Code *</label>
                        <input type="text" id="prod-hsn" required value="39232990" placeholder="e.g., 39232990">
                    </div>
                    <div class="form-group">
                        <label>Rate (‚Çπ) *</label>
                        <input type="number" id="prod-rate" required step="0.01" placeholder="e.g., 128.00">
                    </div>
                    <div class="form-group">
                        <label>Unit *</label>
                        <select id="prod-unit" required>
                            <option value="kg">Kilogram (kg)</option>
                            <option value="pcs">Pieces (pcs)</option>
                            <option value="box">Box</option>
                            <option value="pack">Pack</option>
                            <option value="nos">Numbers (nos)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>GST Rate (%) *</label>
                        <select id="prod-gst" required>
                            <option value="0">0%</option>
                            <option value="5" selected>5% (2.5% CGST + 2.5% SGST)</option>
                            <option value="12">12% (6% CGST + 6% SGST)</option>
                            <option value="18">18% (9% CGST + 9% SGST)</option>
                            <option value="28">28% (14% CGST + 14% SGST)</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label>Description</label>
                        <textarea id="prod-desc" rows="2" placeholder="Optional product description"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('product-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoice-modal" class="modal large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="invoice-modal-title">Create Invoice</h3>
                <button class="close-btn" onclick="closeModal('invoice-modal')">&times;</button>
            </div>
            <form id="invoice-form" onsubmit="saveInvoice(event)">
                <input type="hidden" id="inv-id">
                <div class="invoice-form-grid">
                    <div class="invoice-left">
                        <div class="form-section">
                            <h4>Invoice Details</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Invoice Number</label>
                                    <input type="text" id="inv-number" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Invoice Date *</label>
                                    <input type="date" id="inv-date" required>
                                </div>
                                <div class="form-group">
                                    <label>P.O. Number</label>
                                    <input type="text" id="inv-po" placeholder="e.g., SO-01189">
                                </div>
                                <div class="form-group">
                                    <label>Payment Terms</label>
                                    <select id="inv-terms">
                                        <option value="Advance">Advance</option>
                                        <option value="Due on Receipt">Due on Receipt</option>
                                        <option value="Net 15">Net 15</option>
                                        <option value="Net 30">Net 30</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <input type="date" id="inv-due-date">
                                </div>
                                <div class="form-group">
                                    <label>Place of Supply</label>
                                    <input type="text" id="inv-place" value="Telangana (36)">
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <h4>Customer</h4>
                            <div class="form-group">
                                <label>Select Customer *</label>
                                <select id="inv-customer" required onchange="fillCustomerDetails()">
                                    <option value="">-- Select Customer --</option>
                                </select>
                            </div>
                            <div id="customer-details-preview" class="details-preview"></div>
                        </div>
                    </div>
                    <div class="invoice-right">
                        <div class="form-section">
                            <h4>Items</h4>
                            <div class="items-container">
                                <table class="items-table">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Qty</th>
                                            <th>Rate</th>
                                            <th>GST%</th>
                                            <th>Amount</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoice-items">
                                    </tbody>
                                </table>
                                <button type="button" class="btn btn-secondary" onclick="addInvoiceItem()">+ Add Item</button>
                            </div>
                        </div>
                        <div class="form-section totals-section">
                            <div class="totals-grid">
                                <div class="total-row">
                                    <span>Sub Total:</span>
                                    <span id="inv-subtotal">‚Çπ0.00</span>
                                </div>
                                <div class="total-row">
                                    <span>CGST:</span>
                                    <span id="inv-cgst">‚Çπ0.00</span>
                                </div>
                                <div class="total-row">
                                    <span>SGST:</span>
                                    <span id="inv-sgst">‚Çπ0.00</span>
                                </div>
                                <div class="total-row grand-total">
                                    <span>Total:</span>
                                    <span id="inv-total">‚Çπ0.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <h4>Notes</h4>
                            <textarea id="inv-notes" rows="3" placeholder="Additional notes for this invoice..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('invoice-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Invoice</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Preview Modal -->
    <div id="preview-modal" class="modal large">
        <div class="modal-content preview-content">
            <div class="modal-header">
                <h3>Invoice Preview</h3>
                <div class="preview-actions">
                    <button class="btn btn-primary" onclick="downloadInvoicePDF()">üì• Download PDF</button>
                    <button class="btn btn-secondary" onclick="printInvoice()">üñ®Ô∏è Print</button>
                    <button class="close-btn" onclick="closeModal('preview-modal')">&times;</button>
                </div>
            </div>
            <div id="invoice-preview-container">
                <!-- Invoice preview will be rendered here -->
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

